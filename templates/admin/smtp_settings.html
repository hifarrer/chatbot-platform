{% extends "admin/base.html" %}

{% block title %}SMTP Settings - Admin Panel{% endblock %}

{% block page_title %}SMTP Settings{% endblock %}

{% block content %}
<div class="row">
    <div class="col-12">
        <div class="card">
            <div class="card-header">
                <h5 class="card-title mb-0">
                    <i class="fas fa-envelope me-2"></i>
                    Email Configuration
                </h5>
            </div>
            <div class="card-body">
                <form method="POST">
                    <div class="row">
                        <div class="col-md-6">
                            <div class="form-group mb-3">
                                <label for="smtp_server" class="form-label">SMTP Server *</label>
                                <input type="text" class="form-control" id="smtp_server" name="smtp_server" 
                                       value="{{ smtp_settings.smtp_server if smtp_settings else '' }}" 
                                       placeholder="smtp.gmail.com" required>
                                <small class="form-text text-muted">Your SMTP server address</small>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group mb-3">
                                <label for="smtp_port" class="form-label">SMTP Port *</label>
                                <input type="number" class="form-control" id="smtp_port" name="smtp_port" 
                                       value="{{ smtp_settings.smtp_port if smtp_settings else '587' }}" 
                                       min="1" max="65535" required>
                                <small class="form-text text-muted">Usually 587 for TLS or 465 for SSL</small>
                            </div>
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-6">
                            <div class="form-group mb-3">
                                <label for="smtp_username" class="form-label">Username *</label>
                                <input type="text" class="form-control" id="smtp_username" name="smtp_username" 
                                       value="{{ smtp_settings.smtp_username if smtp_settings else '' }}" 
                                       placeholder="your-email@gmail.com" required>
                                <small class="form-text text-muted">Your SMTP username (usually your email)</small>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group mb-3">
                                <label for="smtp_password" class="form-label">Password *</label>
                                <input type="password" class="form-control" id="smtp_password" name="smtp_password" 
                                       value="{{ smtp_settings.smtp_password if smtp_settings else '' }}" 
                                       placeholder="Your SMTP password" required>
                                <small class="form-text text-muted">Your SMTP password or app password</small>
                            </div>
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-6">
                            <div class="form-group mb-3">
                                <label for="from_email" class="form-label">From Email *</label>
                                <input type="email" class="form-control" id="from_email" name="from_email" 
                                       value="{{ smtp_settings.from_email if smtp_settings else '' }}" 
                                       placeholder="noreply@yourdomain.com" required>
                                <small class="form-text text-muted">Email address that will appear as sender</small>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group mb-3">
                                <label for="from_name" class="form-label">From Name *</label>
                                <input type="text" class="form-control" id="from_name" name="from_name" 
                                       value="{{ smtp_settings.from_name if smtp_settings else '' }}" 
                                       placeholder="Your Company Name" required>
                                <small class="form-text text-muted">Name that will appear as sender</small>
                            </div>
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-6">
                            <div class="form-group mb-3">
                                <label for="admin_email" class="form-label">Admin Email *</label>
                                <input type="email" class="form-control" id="admin_email" name="admin_email" 
                                       value="{{ smtp_settings.admin_email if smtp_settings else '' }}" 
                                       placeholder="admin@yourdomain.com" required>
                                <small class="form-text text-muted">Where contact form emails will be sent</small>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group mb-3">
                                <label class="form-label">Security Options</label>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="smtp_use_tls" name="smtp_use_tls" 
                                           {% if not smtp_settings or smtp_settings.smtp_use_tls %}checked{% endif %}>
                                    <label class="form-check-label" for="smtp_use_tls">
                                        Use TLS (Recommended)
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="smtp_use_ssl" name="smtp_use_ssl" 
                                           {% if smtp_settings and smtp_settings.smtp_use_ssl %}checked{% endif %}>
                                    <label class="form-check-label" for="smtp_use_ssl">
                                        Use SSL
                                    </label>
                                </div>
                                <small class="form-text text-muted">Use TLS for port 587, SSL for port 465</small>
                            </div>
                        </div>
                    </div>
                    
                    <div class="d-flex justify-content-between">
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-save me-2"></i>Save Settings
                        </button>
                        <button type="button" class="btn btn-outline-info" onclick="testSMTP()">
                            <i class="fas fa-paper-plane me-2"></i>Test Email
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

{% endblock %}

{% block scripts %}
<script>
function testSMTP() {
    const button = event.target;
    const originalText = button.innerHTML;
    
    button.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i>Testing...';
    button.disabled = true;
    
    fetch('/admin/smtp-settings/test', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
            'X-Requested-With': 'XMLHttpRequest'
        }
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            alert('✅ ' + data.message);
        } else {
            alert('❌ ' + data.message);
        }
    })
    .catch(error => {
        alert('❌ Error testing SMTP: ' + error.message);
    })
    .finally(() => {
        button.innerHTML = originalText;
        button.disabled = false;
    });
}
</script>
{% endblock %}
